<div class="container">
  <header>
    <h1>ğŸ™ï¸ Kani's Audio Transcriber</h1>
    <p class="subtitle">Upload a file and get it transcribed using AWS Transcribe</p>
  </header>

  <main class="main-content">
    <div class="upload-section">
      <div class="file-input-wrapper">
        <input 
          type="file" 
          id="audioFile" 
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <label for="audioFile" class="file-label">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
          <span>{{ selectedFile ? selectedFile.name : 'Choose File' }}</span>
        </label>
      </div>

      <div *ngIf="selectedFile" class="file-info">
        <p><strong>File:</strong> {{ selectedFile.name }}</p>
        <p><strong>Size:</strong> {{ formatFileSize(selectedFile.size) }}</p>
        <p><strong>Type:</strong> {{ selectedFile.type || 'Unknown' }}</p>
      </div>

      <button 
        class="transcribe-button"
        (click)="showConfirmationModal()"
        [disabled]="!selectedFile || isUploading || isTranscribing"
      >
        <span *ngIf="!isUploading && !isTranscribing">ğŸš€ Upload & Transcribe</span>
        <span *ngIf="isUploading || isTranscribing">â³ Processing...</span>
      </button>

      <button 
        class="saved-jobs-button"
        (click)="showSavedJobs = !showSavedJobs"
        *ngIf="savedJobs.length > 0"
      >
        ğŸ“š Saved Jobs ({{ savedJobs.length }})
      </button>
    </div>

    <!-- Confirmation Modal -->
    <div *ngIf="showConfirmModal" class="modal-overlay" (click)="closeConfirmModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Confirm Upload & Transcribe</h3>
        <div *ngIf="selectedFile" class="modal-file-info">
          <p><strong>File:</strong> {{ selectedFile.name }}</p>
          <p><strong>Size:</strong> {{ formatFileSize(selectedFile.size) }}</p>
          <p><strong>Type:</strong> {{ selectedFile.type || 'Unknown' }}</p>
        </div>
        <p class="modal-message">Are you sure you want to upload this file and start transcription?</p>
        <div class="modal-actions">
          <button class="modal-btn cancel" (click)="closeConfirmModal()">Cancel</button>
          <button class="modal-btn confirm" (click)="confirmAndUpload()">Confirm & Upload</button>
        </div>
      </div>
    </div>

    <!-- Saved Jobs Section -->
    <div *ngIf="showSavedJobs && savedJobs.length > 0" class="saved-jobs-section">
      <div class="saved-jobs-header">
        <h3>ğŸ“š Saved Transcription Jobs</h3>
        <button class="close-btn" (click)="showSavedJobs = false">âœ•</button>
      </div>
      <div class="jobs-list">
        <div *ngFor="let job of savedJobs" class="job-item">
          <div class="job-info">
            <span class="job-status">{{ getJobStatusIcon(job.status) }}</span>
            <div class="job-details">
              <p class="job-file-name"><strong>{{ job.fileName }}</strong></p>
              <p class="job-meta">{{ formatFileSize(job.fileSize) }} â€¢ {{ formatDate(job.startTime) }}</p>
            </div>
          </div>
          <div class="job-actions">
            <button 
              class="job-btn retrieve" 
              (click)="retrieveJob(job)"
              *ngIf="job.status === 'completed' || job.status === 'in_progress'"
            >
              {{ job.status === 'completed' ? 'View' : 'Check Status' }}
            </button>
            <button class="job-btn delete" (click)="deleteJob(job.jobName)">Delete</button>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="isUploading || isTranscribing" class="progress-section">
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="uploadProgress"></div>
      </div>
      <p class="status-text">{{ transcriptionStatus }}</p>
    </div>

    <div *ngIf="errorMessage" class="error-message">
      <strong>âŒ Error:</strong> {{ errorMessage }}
    </div>

    <div *ngIf="transcriptionResult" class="result-section">
      <div class="result-header">
        <h2>ğŸ“ Transcription Result</h2>
        <div class="view-toggle" *ngIf="speakerSegments.length > 0">
          <button 
            class="toggle-btn" 
            [class.active]="showSpeakerView"
            (click)="showSpeakerView = true"
          >
            ğŸ‘¥ By Speaker
          </button>
          <button 
            class="toggle-btn" 
            [class.active]="!showSpeakerView"
            (click)="showSpeakerView = false"
          >
            ğŸ“„ Full Text
          </button>
        </div>
    </div>

      <!-- Search Bar - Sticky -->
      <div class="search-section" [class.has-results]="searchQuery && searchMatches > 0">
        <div class="search-input-wrapper">
          <input 
            type="text" 
            [(ngModel)]="searchQuery"
            (input)="onSearchChange()"
            (keydown.enter)="nextMatch()"
            (keydown.escape)="clearSearch()"
            class="search-input"
            placeholder="ğŸ” Search in transcription..."
          />
          <button 
            *ngIf="searchQuery" 
            class="clear-search-btn"
            (click)="clearSearch()"
            title="Clear search"
          >
            âœ•
          </button>
        </div>
        <div *ngIf="searchQuery && searchMatches > 0" class="search-results-info">
          <span class="match-count">{{ currentMatchIndex + 1 }} of {{ searchMatches }} matches</span>
          <div class="search-navigation">
            <button 
              class="nav-btn"
              (click)="previousMatch()"
              title="Previous match (â†‘ Arrow)"
              [disabled]="searchMatches === 0"
            >
              â†‘ Prev
            </button>
            <button 
              class="nav-btn"
              (click)="nextMatch()"
              title="Next match (â†“ Arrow or Enter)"
              [disabled]="searchMatches === 0"
            >
              Next â†“
            </button>
          </div>
        </div>
        <div *ngIf="searchQuery && searchMatches === 0" class="search-no-results">
          No matches found
        </div>
      </div>

      <!-- Speaker-segmented view - Chat Style -->
      <div *ngIf="showSpeakerView && speakerSegments.length > 0" class="chat-container">
        <!-- Speaker Name Editor Section - Compact -->
        <div class="speaker-names-section-compact" *ngIf="getUniqueSpeakers().length > 0">
          <div class="speaker-names-list-compact">
            <div *ngFor="let speaker of getUniqueSpeakers()" class="speaker-name-item-compact">
              <span class="speaker-color-indicator" [style.background-color]="getSpeakerColor(speaker)"></span>
              <div *ngIf="editingSpeaker !== speaker" class="speaker-name-display-compact">
                <span class="speaker-label-compact">{{ formatSpeakerName(speaker) }}</span>
                <button class="edit-name-btn-compact" (click)="startEditingSpeaker(speaker, $event)" title="Edit name">
                  âœï¸
                </button>
              </div>
              <div *ngIf="editingSpeaker === speaker" class="speaker-name-edit-compact">
                <input 
                  type="text" 
                  [(ngModel)]="editingSpeakerName"
                  (keyup.enter)="saveSpeakerName(speaker)"
                  (keyup.escape)="cancelEditingSpeaker()"
                  class="speaker-name-input-compact"
                  placeholder="Enter name"
                  #nameInput
                  (focus)="nameInput.select()"
                />
                <button class="save-name-btn-compact" (click)="saveSpeakerName(speaker)">âœ“</button>
                <button class="cancel-name-btn-compact" (click)="cancelEditingSpeaker()">âœ•</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Chat Messages -->
        <div class="chat-messages">
          <div 
            *ngFor="let segment of speakerSegments; let i = index" 
            class="chat-message-wrapper"
            [class.message-left]="isSpeakerLeft(segment.speaker)"
            [class.message-right]="!isSpeakerLeft(segment.speaker)"
            [attr.data-segment-index]="i"
            [class.has-search-match]="searchQuery && getMatchCountInSegment(i) > 0"
          >
            <div 
              class="chat-message"
              [style.background-color]="isSpeakerLeft(segment.speaker) ? '#ffffff' : getSpeakerColor(segment.speaker)"
              [style.color]="isSpeakerLeft(segment.speaker) ? '#333' : '#ffffff'"
            >
              <div class="message-header">
                <span class="message-sender">{{ formatSpeakerName(segment.speaker) }}</span>
                <span class="message-time">{{ formatTime(segment.startTime) }}</span>
              </div>
              <div 
                class="message-text"
                [innerHTML]="highlightTextInSegment(segment.text, searchQuery, i)"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Full text view -->
      <div *ngIf="!showSpeakerView || speakerSegments.length === 0" class="transcription-box">
        <p [innerHTML]="highlightText(transcriptionResult, searchQuery)"></p>
      </div>

      <button class="copy-button" (click)="copyToClipboard()">ğŸ“‹ Copy to Clipboard</button>
  </div>
</main>

  <!-- <footer class="info-section">
    <h3>â„¹ï¸ Setup Instructions</h3>
    <ol>
      <li>Configure AWS credentials in <code>aws-config.service.ts</code></li>
      <li>Set up an S3 bucket and update the bucket name</li>
      <li>Ensure your AWS credentials have permissions for S3 and Transcribe</li>
      <li>For production, use AWS Cognito Identity Pool for secure credential management</li>
    </ol>
  </footer> -->
</div>
